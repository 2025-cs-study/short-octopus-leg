# Appendix B | NoSQL 이해하기

## 1. NoSQL이란?

**NoSQL**(Not Only SQL)은 관계형 데이터베이스(RDBMS) 외에 다양한 데이터 저장 방식을 제공하는 데이터베이스 관리 시스템임.

### NoSQL의 등장 배경

- 대용량 데이터를 빠르게 처리해야 하는 요구사항 증가
- 트래픽 증가에 따라 서버를 추가하는 방식으로 대응 필요
- 고정된 스키마 없이 다양한 형태의 데이터를 저장할 필요

### NoSQL의 특징

- 데이터 모델을 사전에 정의하지 않아도 되어 유연함
- 서버 대수를 늘려서 확장 가능
- 여러 서버에 데이터를 분산 저장하고 복제하여 가용성 보장
- 일반적으로 RDBMS보다 쓰기와 읽기 성능이 우수함
- RDBMS처럼 외래 키나 조인을 명시적으로 사용하지 않음

## 2. NoSQL 종류

### 1) Key-Value 데이터베이스

가장 단순한 형태로, 키와 값의 쌍으로 데이터를 저장함.

**특징**:
- 매우 빠른 조회 성능
- 키를 통해 값 전체를 검색할 수 있지만, 값의 일부를 검색하기는 어려움
- 이미지, 동영상 등 어떤 형태의 값도 저장 가능

**대표 제품**: Redis, DynamoDB, Memcached, Riak

**사용 사례**: 캐시, 세션 관리, 실시간 추천 시스템

### 2) Document 데이터베이스

Key-Value 모델을 확장한 형태로, 값을 JSON, XML, YAML 같은 문서 형태로 저장함.

**특징**:
- 문서 ID를 통해 O(1) 시간에 조회 가능
- 계층적 구조의 데이터 저장 가능
- 하나의 객체를 여러 테이블에 나누지 않고 하나의 문서로 저장
- B 트리 인덱스를 사용하여 읽기/쓰기 비율이 7:3일 때 최적 성능

**대표 제품**: MongoDB, CouchDB

**사용 사례**: 중앙 집중식 로그 저장, 타임라인 저장, 통계 정보 저장, 콘텐츠 관리 시스템

### 3) Column-family 데이터베이스

컬럼 단위로 데이터를 저장하는 방식임.

**특징**:
- 하나의 키에 여러 컬럼 이름과 값의 쌍으로 데이터 저장
- 모든 컬럼은 타임스탬프와 함께 저장됨
- 쓰기 연산에 최적화되어 있음
- 대량의 데이터를 빠르게 입력하고 조회하는데 유리

**대표 제품**: Cassandra, HBase, Google Bigtable

**사용 사례**: 채팅 내용 저장, 실시간 분석용 데이터 저장소, 로그 데이터 관리

### 4) Graph 데이터베이스

노드(Nodes), 관계(Relationship), 속성(Key-Value)으로 데이터를 표현함.

**특징**:
- 노드 간의 관계를 직접 저장하여 관계 탐색이 빠름
- 복잡한 관계를 표현하기에 적합

**대표 제품**: Neo4j, OrientDB

**사용 사례**: 소셜 네트워크, 추천 시스템, 지식 그래프, 네트워크 분석

## 3. CAP 정리

<img width="621" height="354" alt="image" src="https://github.com/user-attachments/assets/ef57fea8-be82-4246-9855-58e5d5b0f67c" />

*출처: https://itwiki.kr/w/CAP_%EC%9D%B4%EB%A1%A0

분산 시스템에서는 다음 3가지 속성 중 **2가지만** 동시에 만족할 수 있다는 이론임.

### Consistency (일관성)

- 분산된 노드 중 어느 노드로 접근하더라도 데이터 값이 같아야 함
- 모든 클라이언트가 동시에 같은 데이터를 볼 수 있음
- 쓰기 동작이 완료된 후 발생하는 읽기는 항상 최신 데이터를 반환해야 함

### Availability (가용성)

- 클러스터 중 하나 이상의 노드가 실패해도 정상적으로 요청을 처리할 수 있음
- 모든 요청이 성공 또는 실패 응답을 받을 수 있어야 함

### Partition Tolerance (분할 내성)

- 노드 간 네트워크 장애가 발생해도 정상적으로 서비스를 수행함
- 노드 간 물리적으로 다른 네트워크 공간에 위치 가능

### CAP 조합에 따른 분류

- **CP (일관성 + 분할 내성)**: MongoDB, HBase, Redis
    - 가용성을 희생하고 일관성을 보장
    - 네트워크 분할 발생 시 일부 노드는 응답하지 않을 수 있음

- **AP (가용성 + 분할 내성)**: Cassandra, CouchDB, DynamoDB
    - 일관성을 희생하고 가용성을 보장
    - 최종 일관성(Eventual Consistency)을 제공
    - 일시적으로 다른 데이터를 반환할 수 있으나, 결국에는 일치함

- **CA (일관성 + 가용성)**: 전통적인 RDBMS
    - 분산 환경에서는 네트워크 분할이 필연적이므로 실제로는 불가능

> **💡 참고**: 대부분의 NoSQL은 가용성과 분할 내성을 우선시하며, 최종 일관성을 제공함.

## 4. PACELC 정리

<img width="1000" height="500" alt="image" src="https://github.com/user-attachments/assets/b23599bd-6a4f-474e-8b14-0ac0e0271a25" />

*출처: https://www.geeksforgeeks.org/operating-systems/pacelc-theorem/

**PACELC**는 CAP 정리를 확장한 이론으로, 분산 시스템의 트레이드오프를 더욱 정교하게 설명함.

### PACELC의 의미

- **P (Partition)**: 네트워크 분할이 발생했을 때
    - **A (Availability)** vs **C (Consistency)** 중 선택
- **E (Else)**: 정상 상태일 때
    - **L (Latency)** vs **C (Consistency)** 중 선택

### PACELC에 따른 데이터베이스 분류

#### PA/EL (가용성과 저지연 우선)
- **Cassandra, DynamoDB, Riak**: 네트워크 분할 시 가용성을 선택하고, 정상 상태에서는 낮은 지연시간을 우선시함
- 최종 일관성(Eventual Consistency) 제공
- 대규모 분산 환경에서 빠른 응답 속도가 중요한 경우에 적합

#### PC/EC (일관성 우선)
- **HBase, BigTable**: 네트워크 분할 시와 정상 상태 모두에서 일관성을 우선시함
- 강한 일관성(Strong Consistency) 제공
- 데이터 정확성이 매우 중요한 경우에 적합

#### PC/EL (분할 시 일관성, 정상 시 저지연)
- **MongoDB**: 네트워크 분할 시에는 일관성을 선택하지만, 정상 상태에서는 낮은 지연시간을 우선시함
- 설정을 통해 일관성 수준 조정 가능

#### PA/EC (분할 시 가용성, 정상 시 일관성)
- 이론적으로 가능하지만 실제로는 거의 사용되지 않는 조합

## 5. RDBMS vs NoSQL 비교

| 구분 | RDBMS | NoSQL |
|------|-------|-------|
| **데이터 모델** | 테이블 기반 (행과 열) | 다양한 모델 (Key-Value, Document, Column, Graph) |
| **스키마** | 고정된 스키마 필요 | 유연한 스키마 또는 스키마 없음 |
| **확장성** | 수직 확장 (Scale-Up) | 수평 확장 (Scale-Out) |
| **데이터 일관성** | 강한 일관성 (ACID) | 최종 일관성 (BASE) |
| **트랜잭션** | 완벽한 ACID 트랜잭션 지원 | 제한적인 트랜잭션 지원 |
| **관계 표현** | 외래 키와 조인으로 관계 정의 | 관계를 명시적으로 정의하지 않음 |
| **쿼리 언어** | 표준화된 SQL | 제품마다 다른 쿼리 방식 |
| **성능** | 복잡한 쿼리에 최적화 | 단순 읽기/쓰기에 최적화 |
| **데이터 무결성** | 강력한 무결성 보장 | 애플리케이션 레벨에서 관리 |
| **복잡한 쿼리** | 조인, 서브쿼리 등 강력한 기능 | 제한적이거나 불가능 |
| **사용 사례** | 금융, ERP, 전통적인 비즈니스 앱 | 빅데이터, 실시간 웹, IoT, 소셜 미디어 |
| **데이터 구조 변경** | 복잡하고 비용이 큼 | 상대적으로 쉽고 유연함 |
| **대표 제품** | MySQL, PostgreSQL, Oracle, MS SQL | MongoDB, Cassandra, Redis, Neo4j |

### ACID vs BASE

#### ACID (RDBMS의 특성)
- **Atomicity (원자성)**: 트랜잭션이 모두 성공하거나 모두 실패
- **Consistency (일관성)**: 트랜잭션 전후로 데이터의 일관성 유지
- **Isolation (격리성)**: 동시 실행되는 트랜잭션이 서로 영향을 주지 않음
- **Durability (지속성)**: 완료된 트랜잭션의 결과는 영구적으로 저장

#### BASE (NoSQL의 특성)
- **Basically Available (기본적 가용성)**: 시스템이 항상 응답 가능
- **Soft state (유연한 상태)**: 데이터의 상태가 시간에 따라 변할 수 있음
- **Eventually consistent (최종 일관성)**: 일정 시간 후 모든 노드의 데이터가 일치

## 6. NoSQL 도입 시 고려사항

### 언제 NoSQL을 사용해야 할까?

**NoSQL이 적합한 경우**
- 대용량 데이터를 빠르게 처리해야 할 때
- 데이터 구조가 자주 변경될 때
- 수평 확장이 필요할 때
- 읽기보다 쓰기가 많을 때
- 트랜잭션이 복잡하지 않을 때
- 지리적으로 분산된 데이터 센터가 필요할 때
- 비정형 데이터를 다룰 때

**RDBMS가 적합한 경우**
- 복잡한 트랜잭션이 필요할 때
- 강력한 데이터 무결성이 중요할 때
- 복잡한 조인 연산이 빈번할 때
- 데이터 일관성이 매우 중요할 때
- 표준화된 쿼리 언어가 필요할 때
- 데이터 구조가 명확하고 변경이 적을 때

### NoSQL의 한계

- 대부분의 NoSQL은 ACID 트랜잭션을 완전히 지원하지 않음
- 조인이나 복잡한 쿼리 수행이 제한적임
- RDBMS의 SQL처럼 표준화된 쿼리 언어가 없음
- 분산 환경 관리와 모니터링이 어려울 수 있음
- 각 NoSQL 제품마다 고유한 특성과 사용법을 학습해야 함
- RDBMS에 비해 관리 도구나 모니터링 솔루션이 제한적임

> **💡 중요**: NoSQL은 RDBMS를 대체하는 것이 아니라 보완하는 역할임. 각 시스템의 특성에 맞게 적절히 선택하거나, Polyglot Persistence(다중 저장소 전략)를 통해 RDBMS와 NoSQL을 함께 활용하는 것이 바람직함.

## 참고 자료

1. [IBM, "CAP 정리란?"](https://www.ibm.com/kr-ko/topics/cap-theorem)
2. [굿기드, "NoSQL에 대하여"](https://goodgid.github.io/NoSQL/)